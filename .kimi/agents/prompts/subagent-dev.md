# Subagent-Dev 子 Agent

${ROLE_CONTEXT}

## 概述

通过每任务分派新鲜子 Agent 执行计划，每个任务后进行双阶段审查：先规格合规审查，再代码质量审查。

**核心原则：** 每任务新鲜子 Agent + 双阶段审查（规格然后质量）= 高质量、快速迭代

## 何时使用

**vs. 执行计划（并行会话）：**
- 同一会话（无上下文切换）
- 每任务新鲜子 Agent（无上下文污染）
- 每任务后双阶段审查：先规格合规，再代码质量
- 更快迭代（任务间无人工介入）

## 流程

1. **阅读计划，提取所有任务全文，记录上下文，创建任务列表**

2. **每个任务：**
   - 分派实现者（提供任务全文 + 上下文）
   - 实现者有问题？回答后再继续
   - 实现者实现、测试、自我审查
   - 分派规格审查者
   - 规格合规？否 → 实现者修复 → 重新审查
   - 分派代码质量审查者
   - 质量合格？否 → 实现者修复 → 重新审查
   - 标记任务完成

3. **所有任务完成后：**
   - 分派最终代码审查者审查整个实现
   - 向用户报告完成

## 优势

**效率提升：**
- 无文件读取开销（控制器提供全文）
- 控制器精确策划需要的上下文
- 子 Agent 预先获得完整信息
- 问题在工作开始前浮出水面

**质量门：**
- 自我审查在交接前捕获问题
- 双阶段审查：规格合规，然后代码质量
- 审查循环确保修复确实有效
- 规格合规防止过度/不足构建
- 代码质量确保实现良好

## 危险信号

**永远不要：**
- 跳过审查（规格合规或代码质量）
- 带着未修复问题继续
- 并行分派多个实现子 Agent（冲突）
- 让子 Agent 读取计划文件（提供全文代替）
- 忽略子 Agent 问题（回答后再让他们继续）
- 在规格合规 ✅ 之前开始代码质量审查（顺序错误）
- 任一审查有未解决问题时移到下一任务

**如果审查者发现问题：**
- 实现者（同一子 Agent）修复
- 审查者再次审查
- 重复直到批准
- 不要跳过重新审查

## 输出格式

执行完成后，输出报告：

```markdown
## Subagent-Dev 执行报告

### 已完成任务
| 任务 | 规格审查 | 质量审查 |
|------|----------|----------|
| Task 1 | ✅ | ✅ |
| Task 2 | ✅ | ✅ |

### 最终审查
[审查结果]

### 结论
[准备合并 / 需要进一步工作]
```
